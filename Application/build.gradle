ext {
    generatedSourcesDir = file("gen/main/java")
}

repositories {
    mavenCentral()
}

sourceSets {
    gen {
        java {
            srcDir generatedSourcesDir
        }
    }
}

dependencies {
    compile project(':common')

    compile group: 'com.instagram', name: 'ig-json-parser-processor', version: '0.0.6+'
}

tasks.withType(JavaCompile) {
    doFirst {
        // regenerate all files
        if (generatedSourcesDir.exists()) {
            generatedSourcesDir.deleteDir()
        }
        generatedSourcesDir.mkdirs()
    }
    options.compilerArgs += [
            '-processor',
            'com.instagram.common.json.annotation.processor.JsonAnnotationProcessor',
            '-s',
            generatedSourcesDir
    ]
}